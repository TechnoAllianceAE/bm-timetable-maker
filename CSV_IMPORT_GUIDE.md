# CSV Import Guide

## Overview
The CSV import feature allows you to bulk import school data (classes, teachers, subjects, and rooms) from CSV files generated by the `tt_tester` data generator.

## Quick Start

### 1. Generate Test Data
```bash
cd tt_tester
python3 data_generator.py --config small --prefix school_data
```

This will generate 5 CSV files:
- `school_data_classes_TT_*.csv`
- `school_data_teachers_TT_*.csv`
- `school_data_subjects_TT_*.csv`
- `school_data_rooms_TT_*.csv`
- `school_data_assignments_TT_*.csv` (not used for import)

### 2. Access Import Page
1. Login to the admin panel
2. Navigate to **Import Data** from the sidebar
3. Select the CSV files you want to import
4. Click **Import Data**

## CSV File Formats

### Classes CSV
**Required columns:**
- `class_id` - Unique identifier (e.g., CLASS_001)
- `name` - Class name (e.g., Grade 6A)
- `grade` - Grade level as number (e.g., 6)
- `section` - Section letter (e.g., A)
- `capacity` - Student capacity (e.g., 35)

**Example:**
```csv
class_id,name,grade,section,capacity
CLASS_001,Grade 6A,6,A,35
CLASS_002,Grade 6B,6,B,26
```

### Teachers CSV
**Required columns:**
- `teacher_id` - Unique identifier (e.g., TEACHER_001)
- `name` - Full name
- `email` - Email address (must be unique)
- `phone` - Phone number
- `max_periods_per_day` - Maximum teaching periods per day (e.g., 6)
- `max_periods_per_week` - Maximum teaching periods per week (e.g., 30)
- `subjects_qualified` - Comma-separated subject codes (e.g., "MATH,SCI" or "MATH")

**Example:**
```csv
teacher_id,name,email,phone,max_periods_per_day,max_periods_per_week,subjects_qualified
TEACHER_001,John Doe,john.doe@school.edu,+1-555-123-4567,6,30,"MATH,SCI"
TEACHER_002,Jane Smith,jane.smith@school.edu,+1-555-234-5678,6,30,ENG
```

### Subjects CSV
**Required columns:**
- `code` - Subject code (e.g., MATH)
- `name` - Subject name (e.g., Mathematics)
- `needs_lab` - Boolean (True/False)
- `periods_per_week` - Number of periods per week (e.g., 6)

**Example:**
```csv
code,name,needs_lab,periods_per_week
MATH,Mathematics,False,6
SCI,Science,True,6
ENG,English,False,5
```

### Rooms CSV
**Required columns:**
- `room_id` - Unique identifier (e.g., ROOM_001)
- `name` - Room name (e.g., Classroom 1)
- `type` - Room type (classroom, lab, auditorium)
- `capacity` - Room capacity (e.g., 30)
- `has_projector` - Boolean (True/False) - optional
- `specialization` - Room specialization (e.g., science_lab, computer_lab) - optional

**Example:**
```csv
room_id,name,type,capacity,has_projector,specialization
ROOM_001,Classroom 1,classroom,30,True,
LAB_001,Science Lab 1,lab,21,True,science_lab
LAB_002,Computer Lab 2,lab,34,True,computer_lab
```

## Import Order

The system automatically imports files in the correct order:
1. **Subjects** (no dependencies)
2. **Rooms** (no dependencies)
3. **Teachers** (depends on subjects for qualification)
4. **Classes** (no dependencies)

## Features

### ✅ Validation
- Duplicate email detection for teachers
- Data type validation (numbers, booleans)
- Required field validation

### ✅ Error Handling
- Individual row error handling (one failed row won't stop the entire import)
- Detailed error messages for debugging
- Import status tracking with success/error indicators

### ✅ Progress Tracking
- Real-time import status updates
- Record count for each successful import
- Visual indicators (✓ for success, ✗ for error, ⟳ for in progress)

## Configuration Sizes

The `data_generator.py` supports three sizes:

### Small (--config small)
- 14 classes
- ~48 teachers
- 10 subjects
- 20 rooms

### Medium (--config medium)
- 30 classes
- ~60 teachers
- 10 subjects
- 35 rooms

### Large (--config large)
- 50 classes
- ~121 teachers
- 10 subjects
- 60 rooms

## Troubleshooting

### Email Already Exists
If you see "email already exists" errors:
1. Clear existing teachers from the database, OR
2. Modify the CSV to use unique email addresses

### Invalid Data Type
Ensure:
- Numeric fields (grade, capacity, periods) contain only numbers
- Boolean fields (needs_lab, has_projector) contain "True" or "False"

### Import Partially Succeeded
The system continues importing valid rows even if some fail. Check the import status for details on which records failed and why.

## API Endpoints

The import feature uses these backend endpoints:
- `POST /api/import/classes` - Import classes
- `POST /api/import/teachers` - Import teachers
- `POST /api/import/subjects` - Import subjects
- `POST /api/import/rooms` - Import rooms

All endpoints require JWT authentication and accept multipart/form-data with a `file` field.

## Security

- All import endpoints require authentication (JWT token)
- Imports are scoped to the user's school (schoolId from JWT token)
- File uploads are validated for CSV format
- SQL injection protection through Prisma ORM

## Next Steps

After importing data:
1. Verify the imported data in respective pages (Teachers, Classes, etc.)
2. Create time slots for your school schedule
3. Navigate to **Generate Timetable** to create your first timetable

---

**Generated by tt_tester compatible - Version 1.0**
